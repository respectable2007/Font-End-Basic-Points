<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
	<title>ajax</title>
  </head>
  <body>
    <input type='file' id='file'>
	<img id='img' width='200px'>
    <script type='text/javascript'>
	  function ajax(){
	    var obj = Object.assign({
		  method: 'get',
		  contentType: 'application/x-www-form-urlencoded;charset=UTF-8'
		}, arguments[0])
	    function serialize(data){
		  var ser = '';
		  for(var i in data){
		    ser += i + '=' + data[i] + '&'
		  }
		  return ser.substring(0, ser.length - 1);
		}
		if(!url){
		  return;
		}
	    var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
		  if(xhr.readyState === 4){
		    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
			  console.log(xhr.responseText);
			}
		  }
		}
		if(obj.timeout){
		  xhr.timeout = obj.timeout;
		  xhr.ontimeout = function(e){
		    console.log('timeout');
		  }
		}
		xhr.onabort = function(e){
		  console.log(e);
		}
		xhr.onerror = function(e){
		  console.log(e)
		}
		// 表单提交
		if(obj.contentType){
		  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=UTF-8');
		}
		if(obj.method === 'get'){
		  xhr.open( obj.method,url+'?' + serialize(data), false);
		  xhr.send(null);
		} else {
		  xhr.open( 'post',url, false);
		  xhr.send(serialize(data));
		}
		return xhr;
	  }
	  //图片转为base64
	  var file = document.getElementById('file');
	  file.onchange = function(e){
	    console.log(file);
		var reader = new FileReader();
		    file = e.target.files,
			img = document.getElementById('img');
		reader.readAsDataURL(file[0]);
		reader.onload = function(){
		  console.log(reader.result);
		  img.src = reader.result;
		}
	  }
	  function Ajax(){
	    var default = {
		  method: 'get',
		  contentType: 'application/x-www-form-urlencoded;charset="UTF-8"',
		  async: true//是否异步
		};
		default = Object.assign(default, arguments[0]);
		if(!default.url){
		  return;
		}
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
		  if(xhr.readyState == 4){
		    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){
			  if(default.success){
			    default.success(xhr.responseText);
			  }
			}
		  }
		}
		if(default.contentType) {
		  xhr.setRequestHeader('Content-Type', default.contentType);
		}
		//超时
		if(default.timeout){
		  xhr.timeout = default.timeout;
		  xhr.ontimeout = default.ontimeout || this.nofunction;
		}
		if(default.method == 'get'){
		  xhr.open(default.url + '?' + this.serialize(default.data), default.async);
		  xhr.send(null);
		} else {
		  xhr.open(default.url, default.async);
		  xhr.send(this.serialize(default.data));
		}
		//错误
		xhr.onerror = default.error || this.nofunction;
		//停止
		xhr.onabort = default.abort || this.nofunction;
	  }
	  Ajax.prototype.nofunction = function(){};
	  //序列化
	  Ajax.prototype.serialize = function(data) {
	    var str = '';
		if(typeof data == 'undefined' || !data){
		  return;
		}
		for(var i in data){
		  str += i + '=' + data[i] + '&';
		}
		return str.substring(0, str.length - 1);
	  }
	</script>
  </body>
</html>